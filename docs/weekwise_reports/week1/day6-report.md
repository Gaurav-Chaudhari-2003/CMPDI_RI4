# Day 6 Report --- FTMS Domain Foundation

## Objective

Establish the core database schema for the Fleet & Transport Management
System (FTMS) with a clean, workflow‑correct domain model. The focus was
strictly on data modeling, constraints, and lifecycle readiness. No
business logic or APIs were implemented at this stage.

------------------------------------------------------------------------

## Scope Covered

The schema supports the Phase‑1 workflow:

1.  Employees create booking requests.
2.  Managers approve or reject requests.
3.  Approved bookings get vehicle and driver assigned.
4.  Booking lifecycle transitions are tracked with full audit history.

Advanced modules such as maintenance, vendors, contracts, analytics, and
scheduling were intentionally excluded to maintain domain clarity.

------------------------------------------------------------------------

## Final Booking Lifecycle

The authoritative state machine implemented:

    REQUESTED → APPROVED / REJECTED → ASSIGNED → IN_PROGRESS → COMPLETED / CANCELLED

All lifecycle values are enforced via ENUM to prevent invalid status
entries.

------------------------------------------------------------------------

## Database Tables Implemented

### 1. Vehicles

Purpose: Fleet master registry.

    Key fields: 
                - vehicle_number (unique) 
                - vehicle_type 
                - capacity 
                - status
                - ENUM (ACTIVE, MAINTENANCE, INACTIVE) 
                - default_driver_id (optional) 
                - created_at

Design decisions: - Removed UI‑specific and procurement‑specific
attributes. - Supports default driver mapping while allowing override
during booking assignment.

------------------------------------------------------------------------

### 2. Drivers

    Key fields: 
                - name 
                - phone 
                - license_number (unique) 
                - status ENUM (ACTIVE, INACTIVE) 
                - created_at

    Design decisions: 
        - Drivers are not linked to authentication users to avoid RBAC complexity. 
        - Treated purely as operational resources.

------------------------------------------------------------------------

### 3. Bookings (Core Domain Table)

Purpose: Central workflow entity controlling all transport requests.

    Key fields: 
                - requester_id (FK → users) 
                - requested_vehicle_id (user preference) 
                - assigned_vehicle_id (manager allocation) 
                - assigned_driver_id 
                - approved_by (FK → users) 
                - lifecycle status ENUM 
                - datetime range - locations and purpose
    
    Design decisions: 
        - User vehicle selection treated as preference, not guaranteed allocation. 
        - Assignment occurs only after managerial approval. 
        - Nullable assignment fields support staged workflow progression.

------------------------------------------------------------------------

### 4. Booking Status History

    Purpose: Immutable workflow audit trail.
    
    Key fields: 
                - booking_id 
                - old_status 
                - new_status 
                - changed_by 
                - changed_at
    
    Design decisions: 
        - Enables compliance, traceability, and reporting.  
        - Cascades deletion with booking while preserving user accountability.

------------------------------------------------------------------------

## ENUM Definitions

Centralized ENUMs ensure consistency and type safety:

-   BookingStatus
-   VehicleStatus
-   DriverStatus

These prevent invalid lifecycle transitions and simplify validation.

------------------------------------------------------------------------

## Migration Process

Steps executed:

1.  Models registered with SQLAlchemy metadata.
2.  Alembic migration autogenerated and reviewed.
3.  Foreign key type mismatch resolved by aligning user FK types.
4.  Migration applied successfully to PostgreSQL.
5.  All constraints and indexes verified.

------------------------------------------------------------------------

## Performance Considerations

Indexes added for:

-   Booking time‑range queries
-   Status filtering
-   Foreign key lookups

A composite index on booking datetime supports efficient conflict
detection and availability checks.

------------------------------------------------------------------------

## Seed Data Added

Initial test data inserted:

Drivers: - Ravi Kumar - Suresh Patil

Vehicles: - MH12AB1234 (CAR) - MH12CD5678 (BUS)

------------------------------------------------------------------------

## Outcome

The FTMS domain foundation is fully operational:

-   Clean relational structure
-   Workflow‑correct lifecycle modeling
-   Audit‑ready status tracking
-   Migration‑safe schema

The system is now ready for service‑layer implementation and API
development.

------------------------------------------------------------------------

## Next Phase (Day 7 Preview)

Upcoming work will implement:

-   Booking creation services
-   Approval workflow logic
-   Vehicle and driver assignment rules
-   Status transition enforcement
-   RBAC permission integration
